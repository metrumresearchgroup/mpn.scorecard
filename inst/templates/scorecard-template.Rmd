---
geometry: "left=1.5cm,right=1.5cm,top=2cm,bottom=2cm"
output:
  pdf_document:
    toc: true
    toc_depth: 3
    latex_engine: xelatex
    includes:
      in_header: header.tex
header-includes:
    - \usepackage{caption}
    - \usepackage{graphicx}
    - \usepackage{fancyhdr}
    - \pagestyle{fancy}
    - \setlength\headheight{24pt}
    - \addtolength{\topmargin}{-4pt}
    - \fancyhead[L]{\includegraphics[width=1.25cm]{mpn_logo.png}}
    - \rfoot{\thepage} 
    - \fancyfoot[R]{Metrum Research Group}
params:
  set_title: "Scorecard"
  pkg_scores: "`r list()`"
  mitigation_block: "r NULL"
  extra_notes_data: "r NULL"
  exports_df: "r NULL"
title: >
  `r params$set_title`
subtitle: 'MPN Scorecard'
---

\fontsize{11}{15}
\selectfont

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
                      fig.height = 8, fig.width = 10, ft.keepnext = FALSE)
library(dplyr)
library(flextable)
# init_flextable_defaults()
set_flextable_defaults(font.color = "#333333", border.color = "#999999", padding = 4, fonts_ignore = TRUE)
# set_flextable_defaults(font.color = "#333333", border.color = "#999999", padding = 4, fonts_ignore = FALSE, font.family = "DejaVu Sans")

```

```{r setup_data}
formatted_pkg_scores <- params$pkg_scores
metworx_ver <- paste("Metworx", formatted_pkg_scores$metadata$info$env_vars$METWORX_VERSION)
```

<!-- Remove 'Table x:' prefixes -->
\captionsetup[table]{labelformat=empty}

<br/>

# Overview

This document contains evidence that `r formatted_pkg_scores$pkg_name` `r formatted_pkg_scores$pkg_version` is validated for use on `r metworx_ver` and contains proof points in support of the principles of Good Practice in Documentation, Testing, Maintenance & Stability, and Transparency & Community, as described in **whatever general MPN doc we create**. 

```{r}
format_overall_scores(formatted_pkg_scores)
```

\newpage

# Details

## Documentation, Maintenance & Transparency
```{r, raw scores}
format_package_details(formatted_pkg_scores)
```

## Testing
```{r}
format_testing_scores(formatted_pkg_scores)
```

\newpage

```{r, results = "asis"}
format_mitigation(params$mitigation_block)
```

<!-- Extra notes (formats new page) -->
```{r, results = "asis"}
format_traceability_matrix(params$exports_df)
```

\newpage

# Appendix

## System Info
```{r}
format_metadata(formatted_pkg_scores$metadata)
```

```{r, results = "asis"}
format_appendix(params$extra_notes_data)
```



